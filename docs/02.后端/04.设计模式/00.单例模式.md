---
title: 单例模式
date: 2021-06-15 23:11:10
permalink: /pages/8309a5b876fc9001
categories: 
  - 后端
  - 设计模式
tags: 
  - null
author: 
  name: shirongsheng
  link: https://github.com/shirongsheng
---

### 什么是单例模式？

单例模式是指一个系统中只存在该类的一个实例

### 如何实现单例模式？

单例模式的必要条件有两点：       

1、由private修饰构造器，这样外部就无法通过new关键字创建该类的实例对象了       

2、提供一个由public修改的静态方法，用于返回该类的实例对象        

### 单例模式的使用场景？

1、网站访问次数        

2、配置文件读取

等系统中只需要一个对象存在的场景。       

### 实战

1、假设我们有一个config.properties的配置文件，里面配置了我们给不同客户使用的配置信息，我们程序代码中
则需要读取该配置文件，根据配置信息的不同，执行不同的业务逻辑。 

```
{
    "customer":"tencent",
    "systemName":"LOL",
    "isPay":"true"
}
```

2、此时我们可以新建一个单例类来读取该配置文件内容，代码如下所示。   

```
import com.alibaba.fastjson.JSONObject;

import java.io.*;
import java.nio.charset.StandardCharsets;

public class CustomerConfig {

    private CustomerConfig(){
        ClassLoader classLoader = CustomerConfig.class.getClassLoader();
        String configPath = classLoader.getResource("config/config.properties").getPath();
        File file = new File(configPath);
        int ch = 0;
        StringBuilder sb = new StringBuilder();
        try(Reader reader = new InputStreamReader(new FileInputStream(file), StandardCharsets.UTF_8);){
            while ((ch = reader.read()) != -1){
                sb.append((char) ch);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        customerConfig = JSONObject.parseObject(sb.toString());
    }


    private volatile static CustomerConfig instance = null;

    private static JSONObject customerConfig = new JSONObject();

    public static CustomerConfig getInstance(){
        if (null == instance){
            synchronized (CustomerConfig.class){
                if (null == instance){
                    instance = new CustomerConfig();
                }
            }
        }
        return instance;
    }

    public JSONObject getCustomerConfig(){
        return customerConfig;
    }
}
```

3、编写测试类，测试读取内容      

```
JSONObject customerConfig = CustomerConfig.getInstance().getCustomerConfig();
System.out.println(customerConfig);
```

输出如下        

```
{"isPay":"true","systemName":"LOL","customer":"tencent"}
```

其中构造器中读取配置文件的写法也可以用如下方式     

```
    private CustomerConfig(){
        InputStream resourceAsStream = Thread.currentThread().getContextClassLoader().getResourceAsStream("config/config.properties");
        int ch = 0;
        StringBuilder sb = new StringBuilder();
        try(Scanner scanner = new Scanner(resourceAsStream)){
            while(scanner.hasNextLine()){
                sb.append(scanner.nextLine());
            }
        }catch(Exception e){
            e.printStackTrace();

        }
        customerConfig = JSONObject.parseObject(sb.toString());
    }
```
